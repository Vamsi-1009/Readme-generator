<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>README AI Pro - Bilingual Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0d1117; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
        #preview-content h1 { border-bottom: 1px solid #d0d7de; padding-bottom: .3em; font-size: 2em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; color: #1f2328; }
        #preview-content h2 { border-bottom: 1px solid #d0d7de; padding-bottom: .3em; font-size: 1.5em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; color: #1f2328; }
        #preview-content pre { background-color: #f6f8fa; border-radius: 6px; padding: 16px; border: 1px solid #d0d7de; margin-bottom: 16px; overflow-x: auto; }
        #preview-content code { background-color: rgba(175, 184, 193, 0.2); padding: 0.2em 0.4em; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, monospace; font-size: 85%; }
        #preview-content ul { list-style-type: disc; padding-left: 2em; margin-bottom: 16px; }
        #preview-content p { margin-bottom: 16px; line-height: 1.6; }
    </style>
</head>
<body class="bg-[#0d1117] text-gray-300 font-sans h-screen overflow-hidden flex flex-col">

    <header class="h-16 border-b border-[#30363d] flex items-center justify-between px-6 bg-[#161b22] shadow-xl">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center font-bold text-white shadow-lg text-xl">R</div>
            <div>
                <h1 class="text-lg font-bold text-white leading-none">README Generator</h1>
                <span class="text-[10px] text-blue-400 uppercase tracking-widest font-bold">AI Pro Edition</span>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="copyToClipboard()" class="bg-[#21262d] hover:bg-[#30363d] border border-[#363b42] text-white px-4 py-2 rounded-lg font-medium text-sm transition">
                Copy Code
            </button>
            <button onclick="generateAI()" id="ai-btn" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold text-sm transition-all shadow-lg active:scale-95">
                ‚ú® Generate Full README
            </button>
            <button onclick="downloadDocx()" class="bg-blue-700 hover:bg-blue-600 text-white px-5 py-2 rounded-lg font-medium text-sm transition">Download .docx</button>
            <button onclick="downloadReadme()" class="bg-green-600 hover:bg-green-500 text-white px-5 py-2 rounded-lg font-medium text-sm transition">
                Download .md
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 bg-[#0d1117] border-r border-[#30363d] p-4 flex flex-col hidden lg:flex">
            <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Templates</h3>
            <div id="template-list" class="space-y-1 overflow-y-auto pr-2"></div>
        </aside>

        <section class="flex-1 flex flex-col border-r border-[#30363d]">
            <div class="bg-[#161b22] px-4 py-2 text-[10px] font-bold text-gray-500 uppercase flex justify-between">
                <span>Markdown Input</span>
                <span id="char-count">0 chars</span>
            </div>
            <textarea id="editor" oninput="updatePreview()" 
                class="flex-1 w-full p-8 bg-transparent outline-none resize-none text-gray-300 font-mono text-[14px] leading-relaxed"
                placeholder="Select a template or type your project details here..."></textarea>
        </section>

        <section class="flex-1 flex flex-col bg-white">
            <div class="bg-gray-100 px-4 py-2 text-[10px] font-bold text-gray-500 uppercase flex justify-between items-center">
                <span>Live Rendering</span>
                <button id="toggle-edit-btn" onclick="toggleEditMode()" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-md text-[10px] font-bold uppercase transition hover:bg-blue-200">
                    Edit Result
                </button>
            </div>
            <div class="flex-1 relative">
                <div id="preview-content" class="absolute inset-0 p-10 overflow-y-auto text-[#1f2328]"></div>
                <textarea id="result-editor" oninput="syncFromEdit()" 
                    class="absolute inset-0 p-10 w-full h-full hidden outline-none resize-none font-mono text-sm leading-relaxed border-none text-gray-800 bg-[#fdfdfd]"></textarea>
            </div>
        </section>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview-content');
        const aiBtn = document.getElementById('ai-btn');
        const resultEditor = document.getElementById('result-editor');
        let isEditMode = false;

        const templateData = [
            { name: 'React Web App', icon: '‚öõÔ∏è', prompt: 'A modern React web application with Tailwind CSS and Vite.' },
            { name: 'Node.js Backend', icon: 'üü¢', prompt: 'An Express.js REST API with JWT authentication and MongoDB.' },
            { name: 'Python Package', icon: 'üêç', prompt: 'A reusable Python library published on PyPI.' },
            { name: 'Machine Learning', icon: 'ü§ñ', prompt: 'An ML model training pipeline using Scikit-Learn or PyTorch.' },
            { name: 'Portfolio Website', icon: 'üé®', prompt: 'A personal portfolio website showcasing developer projects.' },
            { name: 'Bilingual Dictionary', icon: 'üìò', prompt: 'Word Guess Dictionary: An interactive English-Telugu vocabulary app using JSON.' },
            { name: 'Mobile App', icon: 'üì±', prompt: 'A cross-platform mobile application built with Flutter.' },
            { name: 'Browser Extension', icon: 'üß©', prompt: 'A Chrome extension that enhances tab productivity.' },
            { name: 'API Documentation', icon: 'üìñ', prompt: 'Comprehensive documentation for a public REST API.' },
            { name: 'CLI Tool', icon: 'üíª', prompt: 'A Command Line Interface tool built with Go or Rust.' },
            { name: 'Discord Bot', icon: 'ü§ñ', prompt: 'A Discord bot with slash commands for server management.' },
            { name: 'Data Analysis', icon: 'üìä', prompt: 'A Jupyter Notebook project analyzing global climate data.' },
            { name: 'Unity Game', icon: 'üéÆ', prompt: 'A 2D platformer game built in Unity with C#.' },
            { name: 'Dockerized App', icon: 'üê≥', prompt: 'A multi-container application managed with Docker Compose.' },
            { name: 'Automation Script', icon: '‚öôÔ∏è', prompt: 'A collection of Python scripts for cloud task automation.' },
            { name: 'Open Source Lib', icon: 'üîì', prompt: 'A community-driven UI component library.' },
            { name: 'Arduino Project', icon: 'üîå', prompt: 'An IoT weather station using ESP32 and DHT11.' },
            { name: 'E-commerce Site', icon: 'üõçÔ∏è', prompt: 'A full-stack e-commerce platform with Stripe integration.' },
            { name: 'Blog Platform', icon: '‚úçÔ∏è', prompt: 'A Next.js blog with Markdown support and SEO optimization.' },
            { name: 'Chat Application', icon: 'üí¨', prompt: 'Real-time chat app using WebSockets and Socket.io.' }
        ];

        const templateList = document.getElementById('template-list');
        templateData.forEach(t => {
            const btn = document.createElement('button');
            btn.className = "w-full text-left p-2 rounded text-sm hover:bg-gray-800 transition flex items-center gap-2 mb-1";
            btn.innerHTML = `<span>${t.icon}</span> ${t.name}`;
            btn.onclick = () => {
                editor.value = t.prompt;
                updatePreview();
            };
            templateList.appendChild(btn);
        });

        function updatePreview() {
            preview.innerHTML = marked.parse(editor.value);
            document.getElementById('char-count').innerText = `${editor.value.length} chars`;
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('toggle-edit-btn');
            if (isEditMode) {
                btn.innerText = "Save & Preview";
                btn.className = "bg-green-100 text-green-600 px-3 py-1 rounded-md text-[10px] font-bold uppercase";
                resultEditor.value = editor.value;
                resultEditor.classList.remove('hidden');
            } else {
                btn.innerText = "Edit Result";
                btn.className = "bg-blue-100 text-blue-600 px-3 py-1 rounded-md text-[10px] font-bold uppercase";
                editor.value = resultEditor.value;
                resultEditor.classList.add('hidden');
                updatePreview();
            }
        }

        function syncFromEdit() {
            editor.value = resultEditor.value;
            updatePreview();
        }

        function downloadDocx() {
            const content = editor.value.trim();
            if (!content) return alert("No content to download!");
        
            // 1. Convert Markdown to HTML (Word handles HTML better for .doc/.docx)
            const htmlContent = marked.parse(content);
        
            // 2. Wrap in basic Word-friendly XML/HTML structure
            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
                    "xmlns:w='urn:schemas-microsoft-com:office:word' "+
                    "xmlns='http://www.w3.org/TR/REC-html40'>"+
                    "<head><meta charset='utf-8'><title>README</title></head><body>";
            const footer = "</body></html>";
            const sourceHTML = header + htmlContent + footer;
        
            // 3. Create a Blob with the application/msword type
            const blob = new Blob(['\ufeff', sourceHTML], {
                type: 'application/msword'
            });
        
            // 4. Trigger Download
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = "README.doc"; // Saves as .doc which Word opens perfectly
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        async function generateAI() {
            const userInput = editor.value.trim();
            if(!userInput) return alert("Please type details or select a template!");
            aiBtn.innerHTML = `<span>‚è≥</span> Writing...`;
            aiBtn.disabled = true;
            try {
                const response = await fetch('http://localhost:3001/generate-readme', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: userInput })
                });
                const data = await response.json();
                if (data.markdown) {
                    editor.value = data.markdown;
                    resultEditor.value = data.markdown;
                    autoFixLayout();
                    updatePreview();
                } else {
                    alert("Error: " + (data.error || "Generation failed."));
                }
            } catch (error) {
                alert("Server not found! Run 'node server.js' first.");
            } finally {
                aiBtn.innerHTML = "‚ú® Generate Full README";
                aiBtn.disabled = false;
            }
        }

        function autoFixLayout() {
            let text = editor.value;
            text = text.replace(/([^\n])\n#/g, '$1\n\n#');
            text = text.replace(/#([^\s#])/g, '# $1');
            editor.value = text;
        }

        function copyToClipboard() {
            editor.select();
            document.execCommand('copy');
            alert("Markdown copied!");
        }

        function downloadReadme() {
            if (!editor.value) return alert("No content!");
            const blob = new Blob([editor.value], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = "README.md";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        updatePreview();
    </script>
</body>
</html>
